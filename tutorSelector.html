<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <meta charset="utf-8" />
  <title>Tutor List</title>
  <link rel="stylesheet" type="text/css" href="Style/Style.css" />

  <!------------------------------------------------------------------------------>
  <!-- Add Firebase products that you want to use                               -->
  <!------------------------------------------------------------------------------>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

  <!------------------------------------------------------------------------------>
  <!-- Optional styles and scripts of your own                                  -->
  <!------------------------------------------------------------------------------>
  <!-- <link rel="stylesheet" href="styles/style.css">
  <script src="scripts/script.js"></script> -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyDwW0SxAa7rQNtirqtI7U1UQkOAudflZWQ",
      authDomain: "project-8839510588664178667.firebaseapp.com",
      databaseURL: "https://project-8839510588664178667.firebaseio.com",
      projectId: "project-8839510588664178667",
      storageBucket: "project-8839510588664178667.appspot.com",
      messagingSenderId: "1096535957963",
      appId: "1:1096535957963:web:258193868d1cfda790964e",
      measurementId: "G-WS6MMHK5X8"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // firebase.analytics();
    var db = firebase.firestore();

  </script>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light ">
    <a class="navbar-brand" href="./index.html">
      <img src="Images/Logo.png" width="30" height="30" class="d-inline-block align-top" alt="" />
      Tutor Finder
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="./index.html">Home</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="./tutorSelector.html">Find a Tutor<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item" id="login" >
          <a class="nav-link" href="./login.html" >Login</a>
        </li>
        <li class="nav-item logout" id="logOut" >
            <a class='nav-link logout' href='javascript:void(0)'>Logout</a>
        </li>
      </ul>
    </div>
  </nav>
  <form class="form-inline">
    <i class="fas fa-search" aria-hidden="true"></i>
    <input class="form-control form-control-sm ml-3 w-75" type="text" placeholder="Search" aria-label="Search" />
  </form>
  <div class="dropdown">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="false">
      Prefrences
    </button>
    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
      <button class="dropdown-item" type="button">Price</button>
      <button class="dropdown-item" type="button">Subject</button>
    </div>
  </div>
  <h2 class="small-title">Tutors</h2>
  <div class="container">
  </div>
  <h3><span id="notifylogin"></span></h3>
  <h6><span class="logout"></span></h6>

  <script>
    $(document).ready(function(){db.collection("Tutors")
      .orderBy("rating")
      .get()
      .then(function (querySnapshot) {
        //querySnapshot.forEach(function (doc) {

          var tutorList = "";
          console.log(querySnapshot.docs);
          for(let i = 1; i <= querySnapshot.size; i++){
            if(i%3 == 1){
              tutorList += "<div class='row'>";
            }
              tutorList +=  "<div class='col-lg-4'>";
              tutorList += "<img src='Images/blank_pp.png' class='pp'>"
              tutorList +=  "<button type='button' class='btn btn-link'><a id='"+i+"' href='./tutorProfile.html'><span class='name'></span></a></button>";
              tutorList += "<div class='bio'>";
              tutorList += "<div><span id='price"+i+"'></span></div>";
              tutorList += "<div><span id='subject"+i+"'></span></div>";
              tutorList += "</div></div>";
            if(i%3 == 0){
              tutorList += "</div>";
            }
          }
          console.log(tutorList);
          $(".container").html(tutorList);
          let c = 1;
          querySnapshot.forEach(function (doc) {
            
                var name = document.getElementById(c);
                var price = document.getElementById("price"+c);
                var subject = document.getElementById("subject"+c);
                name.innerHTML = doc.data().name;
                price.innerHTML = "Price: $" + doc.data().price + "/h";
                subject.innerHTML = "Subject: " + doc.data().subject;

                c++;
          });
          for(let count =1; count <=querySnapshot.size;count++){
            $("#"+count).click(function (event) {
                  event.preventDefault();
                  queryString = document.getElementById(count);
                  window.location.href = "./tutorProfile.html?tutor=" + queryString.innerHTML;
            });
          }
          
      });
    });
//^^^^^^^^^^^^^^^^^^^^^^ASSIGNS PROPER TUTOR NAME VARIABLE TO URL DEPENDING ON NAME CLICKED^^^^^^^^^^^^^^^^^^^^



firebase.auth().onAuthStateChanged(function (user) {
      if (user) {
        console.log("Logged in as" + user);
        document.getElementById('notifylogin').innerHTML = "LOGGED IN"; 
        document.getElementById('login').innerHTML =" <a class='nav-link' href='./login.html' ></a>";
        document.getElementById('logOut') = "<a class='nav-link logout' href='javascript:void(0)'>Logout</a>"
      
        
        //document.getElementById('logout').innerHTML = "click to LOGOUT";
 
 
      } else {
        console.log("not logged in");
        document.getElementById('notifylogin').innerHTML = "LOGIN to book appoitments";
        document.getElementById('login').innerHTML="<a class='nav-link' href='./login.html' >Login</a>";
        document.getElementById('logOut').innerHTML = "<a class='nav-link logout' href='javascript:void(0)'></a>"
        

      }
    });



   
      $(".logout").click(function (event) {
          event.preventDefault();
          firebase.auth().signOut().then(function () {
            console.log('logged out');
          }).catch(function (error) {
            console.log('error');
            // An error happened.
          });
        });
  </script>

</body>

</html>